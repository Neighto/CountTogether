
<html>
<head>
    <script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.7.0.js"></script>

    <script type="text/javascript">
    var ViewManager = {
      views: {},
      current_view_id: null,

      init: function() {
        var views = document.querySelectorAll('.view');
        for (var i = 0; i < views.length; i++) {
          this.views[views[i].id] = views[i];
        }
        return this;
      },

      show: function(id) {
        var view = this.views[id];
        if (view) {
            this.current_view_id = id;
          this.hideAll();
          view.style.display = "block";
        } else {
          console.warn("Could not find view with ID:", id);
        }
        return this;
      },

      hideAll: function() {
        for (var key in this.views) {
          this.views[key].style.display = "none";
        }
      }
    };
    </script>

    <script type="text/javascript">
    var airconsole;

    function App() {
        var me = this;

        me.airconsole = new AirConsole({ "orientation": "portrait" });

        me.airconsole.onActivePlayersChange = function(player_number) {
            updateText(player_number); //PROBLEM: THIS DOES NOT SEEM TO BE CALLED IF ENTERING PLAYER DOES NOT CALL START GAME??
        }
        me.airconsole.onReady = function() {
            updateText();
        }

        //initialize the view manager and set the first view
        ViewManager.init();
        ViewManager.show("Menu");

        me.airconsole.onCustomDeviceStateChange = function (device_id, device_data) {
            //to see logs from the controller, start your game in the "virtual controllers" browser start mode from Unity and open your browser's developer console. 
            console.log("onCustomDeviceStateChange", device_id, device_data);

            //check if the device that sent the custom device state change is the Screen (i.e. the Unity Game, in this case), and not one of the other controllers
            if (device_id == AirConsole.SCREEN) {
                //check if the CustomDeviceStateChange data contains any view data
                if (device_data["view"] != null && device_data["view"] != "") {
                    //set a new view accordingly
                    ViewManager.show(device_data["view"]);
                }

                //check if there's any player color data
                if (device_data["playerColors"] != null) {
                    //check the CustomDeviceStateChange data contains any playerColorData for this particular device
                    if (device_data["playerColors"][me.airconsole.getDeviceId()]) {
                        //this works for named colors. If you want to use colors that don't have a name, you could pass a hex code instead of a string/name
                        document.getElementById("background").style.backgroundColor = device_data["playerColors"][me.airconsole.getDeviceId()];
                    }
                }
            }
        };

      if (!("ontouchstart" in document.createElement("div"))) {
        var elements = document.getElementsByTagName("*");
        for (var i = 0; i < elements.length; ++i) {
          var element = elements[i];
          var ontouchstart = element.getAttribute("ontouchstart");
          if (ontouchstart) {
            element.setAttribute("onmousedown", ontouchstart);
          }
          var ontouchend = element.getAttribute("ontouchend");
          if (ontouchend) {
            element.setAttribute("onmouseup", ontouchend);
          }
        }
      }
    }

	function updateText(player_number) {
	  var div = document.getElementById("player_id");
	  if (player_number >= 4) {
	    ViewManager.show("Full");
        div.innerHTML = "Too many players!";
      } else {
        div.innerHTML = "YOU ARE PLAYER " + (player_number + 1);
      };
	}

    function count(amount) {
        airconsole.message(AirConsole.SCREEN, { action: "count", count: amount })
    }

    function prepped() {
        airconsole.message(AirConsole.SCREEN, {action: "prepped"})
    }

    </script>


    <style type="text/css">

        @font-face {
            font-family: 'Arial';
        }

        html, body {
            height: 100%;
            margin: 0px;
            font-family: 'PressStart2P', sans-serif;
            color: white;
            text-align: center;
            background-color: black;
        }

        #background {
            width: 100%;
            height: 100%;
            position: absolute;
        }

        .button {
            display: block;
            background-color: #bbb;
            margin: 50px;
            width: 85%;
            height: 85%;
            margin-left: auto;
            margin-right: auto;
        }

        .button-text {
            position: absolute;
            color: black;
            font-family: sans-serif;
            text-align: center;
            pointer-events: none;
            width: 50%;
            height: 20%;
            left: 25%;
            top: 40%;
        }

        .button-active {
            border: solid #727272 2px;
        }

        #player_id {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 30px;
            background-color: black;
            color: white;
            text-align: center;
        }
    </style>


</head>


<body onload="App()">

    <div class="view" id="Count">
        <div class="button" id="ingame-button" ontouchstart="count(1)"></div>
        <div class="button-text">COUNT</div>
    </div>
    <div class="view" id="Full">
        <div class="button-text">The game is full! If space frees up, try reconnecting.</div>
    </div>
    <div class="view" id="Menu">
        <div class="button" id="menu-button" ontouchstart="prepped()"></div>
        <div class="button-text">READY TO START</div>
    </div>
    <div class="view" id="Wait">
        <div style="color:white;">You're in! Wait for Instructions.</div>
    </div>
    <div id="player_id"></div>
</body>

</html>